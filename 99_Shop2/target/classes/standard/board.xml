<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="board.model.Board">
	<select id="GetCount" resultType="int">
		select count(*) from board
	<if test="whatColumn == 'type'">
		where type like #{keyword}
	</if>
	<if test="whatColumn == 'category'">
		where category like #{keyword}
	</if>
	<if test="whatColumn == 'title'">
		where title like #{keyword}
	</if>
	</select>
	
	<select id="GetBoardList" resultType="MyBoard">
		select * from board
	<if test="whatColumn == 'type'">
		where type like #{keyword}
	</if>
	<if test="whatColumn == 'category'">
		where category like #{keyword}
	</if>
	<if test="whatColumn == 'title'">
		where title like #{keyword}
	</if>
		order by no	desc
	</select>
	
	<insert id="BoardInsert" parameterType="int">
		insert into board(no,type,category,title,content,reg_date,nickname)
		values(board_seq.nextval,#{type},#{category},#{title},#{content},sysdate,#{nickname}) 	
	</insert>
	
	<select id="GetBoard" resultType="MyBoard">
		select * from board where no = #{no}
	</select>
	
	<update id="ReadCountUpdate">
		update board set readcount = readcount + 1 where no = #{no}
	</update>
	
	<select id="GetRnum" resultType="int">
		select rnum from(select a.*,rownum rnum from(select * from board order by no desc)a) where no = #{no}
	</select>
	
	<select id="GetNextMove" resultType="MyBoard">
		select * from(select a.*,rownum rnum from(select * from board order by no desc)a) where rnum = #{rnum}+1
	</select>
	
	<select id="GetBeforeMove" resultType="MyBoard">
		select * from(select a.*,rownum rnum from(select * from board order by no desc)a) where rnum = #{rnum}-1
	</select>
	
	<select id="MaxRnum" resultType="int">
		select max(rnum) from(select a.*,rownum rnum from(select * from board order by no desc)a)
	</select>
	
	<update id="BoardUpdate">
		update board set type=#{type}, category=#{category}, title=#{title}, content=#{content} where no=#{no}
	</update>
	
	<delete id="BoardDelete">
		delete from board where no = #{no}
	</delete>

	<insert id="BoardReplyInsert">
		insert into reply(rno, no, rcontent, rreg_date, ref, relevel, nickname) values(reply_seq.nextval, #{no}, #{rcontent}, sysdate, reply_seq.currval,0, #{nickname})
	</insert>
	
	<select id="GetReplyCount" resultType="int">
		select count(*) from reply where no = #{no}
	</select>
	
	<select id="GetReplyList" resultType="MyReply">
		select * from reply where no = #{no} order by ref desc, relevel asc, rno desc 
	</select>
	
	<select id="GetRcontent" resultType="string">  
		select rcontent from reply where rno =  #{rno}
	</select>
	
	<update id="BoardReplyUpdate">
		update reply set rcontent = #{rcontent}, rreg_date = sysdate where rno = #{rno}
	</update>
	
	<delete id="BoardReplyDelete">
		delete from reply where rno = #{rno}
	</delete>
	
	<insert id="BoardRe_replyInsert">
		insert into reply(rno, no, rcontent, rreg_date, ref, relevel, nickname) values(reply_seq.nextval, #{no}, #{rcontent}, sysdate, #{ref}, 1, #{nickname})
	</insert>
	
	<update id="RePageSizeUpdate">
		update reply set rePageSize = rePageSize + #{rePageSize} where no = #{no}
	</update>
	
	<select id="GetReplyList2" resultType="MyReply">
		select * from(select  A.*, rownum rn from(select * from reply where no = #{no}
		order by ref desc, relevel asc, rno desc)A) where rn between 1 and #{rePageSize} 
	</select>
	
	<update id="UpdateReplyconunt">
		update board set replycount = #{cnt} where no = #{no}
	</update>
	
	<select id="GetNick" resultType="string">
		select nickname from board where nickname = #{nickname} and no = #{no}
	</select>
	
	<select id="GetReNick" resultType="string">
		select nickname from reply where nickname = #{nickname} and rno = #{rno}
	</select>
	
</mapper>  